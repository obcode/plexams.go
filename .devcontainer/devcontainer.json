{
  "name": "plexams-go",
  "build": {
    "dockerfile": "Dockerfile"
  },
  "features": {
    "ghcr.io/devcontainers/features/go:1": {
      "version": "1.26.0"
    },
    "ghcr.io/devcontainers-extra/features/pre-commit:2": {}
  },
  "customizations": {
    "vscode": {
      "extensions": [
        "golang.Go",
        "eamodio.gitlens",
        "gruntfuggly.todo-tree",
        "oderwat.indent-rainbow",
        "pkief.material-icon-theme"
      ],
      "settings": {
        "go.useLanguageServer": true,
        "go.lintTool": "golangci-lint-v2",
        "go.lintFlags": [
          "--path-mode=abs",
          "--fast-only"
        ],
        "go.formatTool": "custom",
        "go.alternateTools": {
          "customFormatter": "golangci-lint-v2"
        },
        "go.formatFlags": [
          "fmt",
          "--stdin"
        ],
        "go.testOnSave": true,
        "editor.formatOnSave": true,
        "editor.tabSize": 4,
        "editor.insertSpaces": true,
        "editor.detectIndentation": true,
        "editor.rulers": [
          80,
          120
        ],
        "files.exclude": {
          "**/.git": true,
          "**/.svn": true,
          "**/.hg": true,
          "**/CVS": true,
          "**/.DS_Store": true
        },
        "terminal.integrated.defaultProfile.linux": "zsh",
        "terminal.integrated.cwd": "${workspaceFolder}"
      }
    }
  },
  "mounts": [
    "source=shared-binaries,target=/shared/bin,type=volume",
    "source=pruefungsplanung-semester,target=/home/ubuntu/semester,type=volume",
    // "source=${localEnv:HOME}/semester,target=/home/ubuntu/semester,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.gitconfig,target=/home/ubuntu/.gitconfig,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.ssh,target=/home/ubuntu/.ssh,type=bind,consistency=cached",
    "source=${localEnv:HOME}/.plexams.yml,target=/home/ubuntu/.plexams.yml,type=bind,consistency=cached"
  ],
  // mount the workspace into a named Docker volume instead of bind-mounting the host repo
  "workspaceMount": "source=${localWorkspaceFolderBasename},target=/workspace/${localWorkspaceFolderBasename},type=volume",
  "workspaceFolder": "/workspace/${localWorkspaceFolderBasename}",
  "forwardPorts": [
    8080,
    8081,
    8082
  ],
  "portsAttributes": {
    "8080": {
      "label": "Application",
      "onAutoForward": "notify"
    }
  },
  "postCreateCommand": "go install github.com/HenriBeck/gowatch@latest; sudo chown -R ubuntu:ubuntu /shared/bin ; sudo chown -R ubuntu:ubuntu /workspace/plexams.go",
  "postStartCommand": "/shared/bin/gowatch",
  "remoteEnv": {
    "GOBIN": "/shared/bin",
    "PATH": "${containerEnv:PATH}:/shared/bin"
  },
  "runArgs": [
    "--network=host"
  ]
}